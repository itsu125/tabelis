<%= form_with model: shop, local: true do |f| %>

  <%# 店名 %>
  <div class="mb-4">
    <%= f.label :name, "店名（必須）", class: "block text-sm font-medium mb-1 text-t-text-mid" %>
    <%= f.text_field :name,
          class: "w-full p-3 rounded-lg border border-t-border bg-white focus:ring-t-primary focus:border-t-primary" %>
  </div>

  <%# カテゴリ %>
  <div class="mb-4">
    <%= f.label :category_id, "カテゴリ（任意）", class: "block text-sm font-medium mb-2 text-t-text-mid" %>

    <div class="flex flex-wrap gap-2">
      <% Category.all.each do |category| %>
        <label class="cursor-pointer">
          <%= f.radio_button :category_id, category.id, class: "hidden" %>
          <span class="category-btn px-3 py-1 rounded-full text-sm transition">
            <%= category.name %>
          </span>
        </label>
      <% end %>

      <%# 「未選択に戻す」ボタン %>
      <label class="cursor-pointer">
        <%= f.radio_button :category_id, nil, class: "hidden peer" %>
        <div class="px-3 py-1 rounded-full border border-t-border text-sm
                    peer-checked:bg-gray-300 peer-checked:text-t-dark
                    hover:bg-gray-200 transition">
          選択しない
        </div>
      </label>
    </div>
  </div>

  <%# 画像 %>
  <div class="mb-4">
    <%= f.label :image, "写真・画像（任意）", class: "block text-sm font-medium mb-1 text-t-text-mid" %>

    <%# アップロードボタン %>
    <label class="flex items-center px-4 py-2 bg-t-secondary text-t-dark font-medium rounded-lg shadow cursor-pointer hover:bg-t-primary hover:text-white transition">
      画像を選択
      <%= f.file_field :image, class: "hidden", id: "file_input" %>
    </label>

    <%# ファイル名 %>
    <p id="file_name" class="text-sm text-gray-500 mt-2"></p>

    <%# プレビュー枠（詳細ページと統一） %>
    <div class="mt-3 w-full h-56 overflow-hidden rounded-lg border border-t-border bg-t-light-header flex items-center justify-center">
      <img
        id="image_preview"
        src="<%= shop.image.attached? ? url_for(shop.image) : '' %>"
        alt="選択画像プレビュー"
        class="w-full h-full object-cover <%= shop.image.attached? ? '' : 'hidden' %>"
      >
    </div>
  </div>

  <!-- タグ（シーン） -->
  <div class="mb-4">
    <label class="block text-sm font-medium mb-1 text-t-text-mid">タグ（複数選択可）</label>
    <div id="tag-select" class="flex flex-wrap gap-2">
      <% Tag.all.each do |tag| %>
        <% selected = shop.tags.include?(tag) %>
        <button
          type="button"
          data-tag-id="<%= tag.id %>"
          data-tag-color-class="<%= tag.color_class %>"
          class="tag-pill px-3 py-1 rounded-full text-xs border
                 <%= selected ? tag.color_class : 'bg-gray-200 text-gray-700 border-gray-300' %>">
          <%= tag.name %>
        </button>
      <% end %>
    </div>
    <!-- hidden inputs（複数選択用） -->
    <%= hidden_field_tag "shop[tag_ids][]", nil %>  <%# 空を送ることで未選択も許容 %>
    <% shop.tags.each do |tag| %>
      <%= hidden_field_tag "shop[tag_ids][]", tag.id %>
    <% end %>
  </div>

  <%# URL %>
  <div class="mb-4">
    <%= f.label :url, "URL（任意）", class: "block text-sm font-medium mb-1 text-t-text-mid" %>
    <%= f.url_field :url,
          placeholder: "https://example.com",
          class: "w-full p-3 rounded-lg border border-t-border bg-white focus:ring-t-primary focus:border-t-primary" %>
  </div>

  <%# 住所 %>
  <div class="mb-4">
    <%= f.label :address, "住所（任意）", class: "block text-sm font-medium mb-1 text-t-text-mid" %>
    <%= f.text_field :address,
            class: "w-full p-3 border border-t-border rounded-lg bg-white focus:ring-t-primary focus:border-t-primary" %>
  </div>

  <%# わくわく度（5段階） %>
  <div class="mb-4">
    <label class="block text-sm font-medium mb-1 text-t-text-mid">わくわく度（5段階）</label>
    <div class="flex space-x-1 text-3xl cursor-pointer">
      <span data-star="1" class="text-gray-300">★</span>
      <span data-star="2" class="text-gray-300">★</span>
      <span data-star="3" class="text-gray-300">★</span>
      <span data-star="4" class="text-gray-300">★</span>
      <span data-star="5" class="text-gray-300">★</span>
    </div>
    <%= f.hidden_field :rating, id: "shop_rating" %>
  </div>

  <%# メモ %>
  <div class="mb-4">
    <%= f.label :memo, "メモ（任意）", class: "block text-sm font-medium mb-1 text-t-text-mid" %>
    <%= f.text_area :memo,
          rows: 3,
          class: "w-full p-3 rounded-lg border border-t-border bg-white focus:ring-t-primary focus:border-t-primary" %>
  </div>

  <%# ステータス %>
  <div class="mb-6">
    <%= f.label :status, "リスト", class: "block text-sm font-medium mb-2 text-t-text-mid" %>

    <div class="space-y-2">
      <label class="flex items-center space-x-2">
        <%= f.radio_button :status, "want", class: "text-t-primary" %>
        <span>行きたい</span>
      </label>

      <label class="flex items-center space-x-2">
        <%= f.radio_button :status, "went", class: "text-t-primary" %>
        <span>行った</span>
      </label>
    </div>
  </div>

  <%# 保存ボタン %>
  <div class="mt-6">
    <%= f.submit (shop.new_record? ? "追加する" : "更新する"),
        class: "w-full py-4 text-lg font-bold text-white rounded-xl transition duration-200 cursor-pointer 
                bg-t-primary shadow-[0_4px_0_0_#d8763a] active:shadow-[0_2px_0_0_#d8763a]" %>
  </div>

<% end %>
